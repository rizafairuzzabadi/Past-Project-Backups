<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link href="../fontawesome-free-5.15.4-web/css/all.css" rel="stylesheet" />
    <link rel="stylesheet" href="./style.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
      integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
      integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
      crossorigin="anonymous"
    ></script>

    <title>Turkcell AdDesigner</title>
  </head>

  <body>
    <div class="container-fluid">
      <div class="row">
        <div
          class="col-sm-auto bg-light sticky-top turkcellblue"
          style="padding: 0"
        >
          <div
            class="d-flex flex-sm-column flex-row flex-nowrap bg-light align-items-center sticky-top"
          >
            <ul
              class="nav nav-pills nav-flush flex-sm-column flex-row flex-nowrap mb-auto mx-auto text-center justify-content-between w-100 px-3 align-items-center turkcellblue"
            >
              <li class="nav-item">
                <a
                  href="../../api/src/loaders/starter.html"
                  class="nav-link py-3 px-2 text-white"
                  title=""
                  data-bs-toggle="tooltip"
                  data-bs-placement="right"
                  data-bs-original-title="Home"
                >
                  <i class="bi bi-arrow-left fs-5"></i>
                </a>
              </li>
              <li>
                <a
                  href="#"
                  class="nav-link py-3 px-2 text-white"
                  title=""
                  data-bs-toggle="tooltip"
                  data-bs-placement="right"
                  data-bs-original-title="Dashboard"
                >
                  <i class="bi bi-list fs-5"></i>
                </a>
              </li>
            </ul>

            <div class="dropdown">
              <a
                href="#"
                class="d-flex align-items-center justify-content-center p-3 link-dark text-decoration-none dropdown-toggle turkcellblue"
                id="dropdownUser3"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="bi-person-circle fs-5 text-white"></i>
              </a>
              <ul
                class="dropdown-menu text-small shadow"
                aria-labelledby="dropdownUser3"
              >
                <li><a class="dropdown-item" href="#">New project...</a></li>
                <li><a class="dropdown-item" href="#">Settings</a></li>
                <li><a class="dropdown-item" href="#">Profile</a></li>
              </ul>
            </div>

            <a
              href="/"
              class="d-block p-3 link-dark text-decoration-none"
              style="position: fixed; bottom: 0"
              title=""
              data-bs-toggle="tooltip"
              data-bs-placement="right"
              data-bs-original-title="Icon-only"
            >
              <img
                src="AMBLEM_SARI.png"
                alt="Avatar"
                class="fs-5"
                style="width: 100%; height: 100%"
              />
            </a>
          </div>
        </div>

        <div class="col-sm p-3 min-vh-100 ExpanderBody" id="canvas">
          <div class="TheExpander">
            <h1 class="mainTitle">Some Example Text</h1>
            <input style="visibility: hidden" id="toggle" type="checkbox" />
            <label for="toggle" class="toggleButton">Click to Expand</label>

            <div id="expand">
              <a href="#">
                <div class="ImageDiv">
                  <img src="image.png" alt="" />
                </div>
              </a>
            </div>
          </div>
        </div>

        <!-- <div class="col-sm-auto bg-light sticky-top theme-grey" style="padding:0"> -->

        <div
          class="col-md-auto flex-shrink-0 p-3 theme-grey"
          style="width: 280px"
        >
          <a
            href="/"
            class="d-flex align-items-center pb-3 mb-3 link-dark text-decoration-none border-bottom text-center"
          >
            <span class="fs-5 fw-semibold text-white px-2">
              Expanding Template
            </span>
          </a>
          <div class="componentmenutext">
            <div class="row">
              <p style="color: white; font-size: 1.2em" class="text-center">
                Collapsed
              </p>
              <div class="input-group mb-3">
                <input
                  type="text"
                  class="form-control componentmenutext"
                  placeholder="000"
                  aria-label="Username"
                />
                <span class="input-group-text componentmenutext">px</span>
                <input
                  type="text"
                  class="form-control componentmenutext"
                  placeholder="000"
                  aria-label="Server"
                />
                <span class="input-group-text componentmenutext">px</span>
              </div>
            </div>

            <div class="row">
              <p
                style="color: white; font-size: 1.2em"
                class="text-center mt-1 mb-1.5"
              >
                Expanded
              </p>
              <div class="input-group mb-3">
                <input
                  type="text"
                  class="form-control componentmenutext"
                  placeholder="000"
                  aria-label="Username"
                />
                <span class="input-group-text componentmenutext">px</span>
                <input
                  type="text"
                  class="form-control componentmenutext"
                  placeholder="000"
                  aria-label="Server"
                />
                <span class="input-group-text componentmenutext">px</span>
              </div>
            </div>

            <div class="row">
              <p
                style="color: white; font-size: 1.2em"
                class="text-center mt-1 mb-1.5"
              >
                Width & Height
              </p>
              <div class="input-group mb-3">
                <input
                  type="number"
                  class="form-control componentmenutext dImgWidth"
                  placeholder="000"
                  aria-label="Username"
                  min="100"
                  max="400"
                />
                <span class="input-group-text componentmenutext">px</span>
                <input
                  type="number"
                  class="form-control componentmenutext dImgHeight"
                  placeholder="000"
                  aria-label="Server"
                  min="100"
                  max="400"
                />
                <span class="input-group-text componentmenutext">px</span>
              </div>
            </div>

            <!-- <p style="color: white" class="text-left mt-1 ">Width:</p>
            <input class="dImgWidth mt-1 text-white"  type="number" min="100" max="400">
            <p style="color: white" class="text-left mt-1 ">Height:</p>
            <input class="dImgHeight mt-1 text-white" type="number" min="100" max="400"> -->
            <!-- <button onclick="downloadCanvas()" class="mt-1">Download</button> -->
            <input id="draggableImage" type="file" class="mt-1 text-white" />
            <!-- <button id="test" onclick="renderDiv()" class="mt-1"> Add Div </button> -->

            <p style="color: white; font-size: 1.3em" class="text-center mt-3">
              Title, Link and File Upload
            </p>

            <input type="text" placeholder="Title" id="TitleInput" />
            <input
              type="text"
              placeholder="Link"
              id="expandlink"
              class="mt-1"
            />
            <input id="expandNewImage" type="file" class="mt-1 text-white" />

            <div class="text-center">
              <p
                style="color: white; font-size: larger"
                class="mt-3 text-center"
              >
                Download HTML5 Creative Files
              </p>

              <button
                id="downloadHTML"
                class="btn btn-outline-light btn-sm componentmenutext text-white"
              >
                <i class="fab fa-html5" style="font-size: xx-large"></i>
              </button>
              <button
                onclick="window.open('style.css')"
                id="downloadCSS"
                class="btn btn-outline-light btn-sm componentmenutext"
              >
                <i class="fab fa-css3" style="font-size: xx-large"></i>
              </button>
              <button
                id="downloadJS"
                class="btn btn-outline-light btn-sm componentmenutext"
              >
                <i class="fab fa-js-square" style="font-size: xx-large"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      function containsSpecialChars(str) {
        const specialChars = /[`!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~]/;
        return specialChars.test(str);
      }
      function download(filename, text) {
        var element = document.createElement("a");
        element.setAttribute(
          "href",
          "data:text/plain;charset=utf-8," + encodeURIComponent(text)
        );
        element.setAttribute("download", filename);

        element.style.display = "none";
        document.body.appendChild(element);

        element.click();

        document.body.removeChild(element);
      }
      var downloadHTML = document.querySelectorAll("#downloadHTML")[0];
      downloadHTML.addEventListener("click", function () {
        var canvasDiv = document.querySelectorAll("#canvas");
        var canvasContent = canvasDiv[canvasDiv.length - 1].innerHTML;
        download("canvas.html", canvasContent);
      });

      var downloadJS = document.querySelectorAll("#downloadJS")[0];
      downloadJS.addEventListener("click", function () {
        var scriptDiv = document.querySelectorAll("script");
        var scriptContent = scriptDiv[scriptDiv.length - 1].innerHTML;
        download("script.js", scriptContent);
      });


      function sleep(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }
      var button = document.getElementsByClassName("toggleButton")[0];
      button.addEventListener("click", function () {
        var img = document.querySelector(".ImageDiv img");
        if (img.style.display.length == 0 || img.style.display.length == 4) {
          console.log(img.style.display);
          console.log("t1");
          img.style.display = "block";
        } else {
          console.log(img.style.display.length);
          console.log("t2");
          img.style.display = "none";
        }
      });

      var titleInput = document.querySelectorAll("#TitleInput")[0];
      titleInput.addEventListener("change", function (event) {
        if (!containsSpecialChars(titleInput.value)) {
          document.querySelectorAll(".mainTitle")[0].textContent =
            titleInput.value;
        }
      });

      var imageLoader = document.querySelectorAll("#expandNewImage")[0];
      var ExImage = document.querySelectorAll(".ImageDiv img")[0];

      imageLoader.addEventListener("change", function (event) {
        var reader = new FileReader();
        reader.onload = function (e) {
          ExImage.src = e.target.result;
        };
        reader.readAsDataURL(imageLoader.files[0]);
      });

      function isValidHttpUrl(string) {
        let url;

        try {
          url = new URL(string);
        } catch (_) {
          return false;
        }

        return url.protocol === "http:" || url.protocol === "https:";
      }
      var LinkInput = document.querySelectorAll("#expandlink")[0];
      var ExLink = document.querySelectorAll("#expand a")[0];
      LinkInput.addEventListener("change", function (event) {
        var result = isValidHttpUrl(LinkInput.value);
        if (result != false) {
          console.log("Changed");
          ExLink.href = LinkInput.value;
        } else {
          ExLink.href = "#";
        }
      });
      const canvas = document.getElementById("canvas");
      var divHeaders = document.querySelectorAll("#mydivheader");
      for (var i = 0; i < divHeaders.length; i++) {
        (function (i) {
          divHeaders[i].addEventListener("mouseover", function (event) {
            event.target.style.opacity = 100;
            console.log(event.target);
          });
        })(i);
      }

      function renderImg(url) {
        var width = document.querySelectorAll(".dImgWidth")[0].value;
        var height = document.querySelectorAll(".dImgWidth")[0].value;
        if (width < 100 && width > 500) {
          width = 300;
        }
        if (height < 100 && height > 500) {
          height = 300;
        }
        var newElement =
          '<div id="mydiv" style="width:' +
          width +
          "px;height:" +
          height +
          '" class="mydiv p"><div id="mydivheader" class="mydivheader">Click here to move</div><img src="$link" alt="" style="width:'.replace(
            "$link",
            url
          ) +
          width +
          "px;height:" +
          height +
          'px" id="tetimg"></div>';

        canvas.innerHTML += newElement;
        elements = document.getElementsByClassName("mydivheader");
        dragElement(elements);
      }
      function renderDiv() {
        canvas.innerHTML +=
          '<div id="mydiv" class="mydiv p"><div id="mydivheader" class="mydivheader">Click here to move</div><a href="https://www.w3schools.com/howto/howto_js_draggable.asp">GOOGLE</a><p>Move</p><p>this</p><p>DIV</p></div>';
        elements = document.getElementsByClassName("mydivheader");
        dragElement(elements);
      }

      let imgUploader = document.querySelectorAll("#draggableImage")[0];
      imgUploader.addEventListener("change", function (event) {
        var reader = new FileReader();
        reader.onload = function (e) {
          let img = document.querySelectorAll("#tetimg")[0];
          renderImg(e.target.result);
        };
        reader.readAsDataURL(imgUploader.files[0]);
      });

      var loadFile = function (event) {
        var output = document.getElementById("output");
        output.src = URL.createObjectURL(event.target.files[0]);
        output.onload = function () {
          URL.revokeObjectURL(output.src); // free memory
        };
      };

      // Make the DIV element draggable:
      var rect = document.getElementById("canvas").getBoundingClientRect();
      var canvasCorners = [rect.top, rect.right, rect.bottom, rect.left];
      elements = document.getElementsByClassName("mydivheader");
      dragElement(elements);
      var currentHeader;
      function dragElement(oneElmn) {
        var pos1 = 0,
          pos2 = 0,
          pos3 = 0,
          pos4 = 0;
        for (var i = 0; i < oneElmn.length; i++) {
          oneElmn[i].onmousedown = dragMouseDown;
        }

        function dragMouseDown(e) {
          var event = e || window.event;
          var target = event.target || event.srcElement;
          currentHeader = target;
          e = e || window.event;
          e.preventDefault();
          // get the mouse cursor position at startup:
          pos3 = e.clientX;
          pos4 = e.clientY;
          document.onmouseup = closeDragElement;
          // call a function whenever the cursor moves:
          document.onmousemove = elementDrag;
        }

        function elementDrag(e) {
          elmnt = currentHeader.parentElement;
          e = e || window.event;
          e.preventDefault();
          // calculate the new cursor position:
          var width = Math.floor(elmnt.getBoundingClientRect().width) + 1;
          var height = Math.floor(elmnt.getBoundingClientRect().height) + 1;
          pos1 = pos3 - e.clientX;
          pos2 = pos4 - e.clientY;
          pos3 = e.clientX;
          pos4 = e.clientY;
          // set the element's new position:
          if (
            elmnt.offsetLeft - pos1 + width < canvasCorners[1] &&
            elmnt.offsetLeft - pos1 > canvasCorners[3]
          ) {
            elmnt.style.left = elmnt.offsetLeft - pos1 + "px";
          }
          if (
            elmnt.offsetTop - pos2 + height < canvasCorners[2] &&
            elmnt.offsetTop - pos2 > canvasCorners[0]
          ) {
            elmnt.style.top = elmnt.offsetTop - pos2 + "px";
          }
        }

        function closeDragElement() {
          for (var i = 0; i < divHeaders.length; i++) {
            divHeaders[i].style.opacity = 0;
          }
          // stop moving when mouse button is released:
          document.onmouseup = null;
          document.onmousemove = null;
        }
      }
    </script>
  </body>
</html>
