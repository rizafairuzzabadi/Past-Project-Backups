<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <link href="../fontawesome-free-5.15.4-web/css/all.css" rel="stylesheet" />

    <link rel="stylesheet" href="./carousel.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
      integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
      integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
      crossorigin="anonymous"
    ></script>

    <title>Turkcell AdDesigner</title>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <div
          class="col-sm-auto bg-light sticky-top turkcellblue"
          style="padding: 0"
        >
          <div
            class="d-flex flex-sm-column flex-row flex-nowrap bg-light align-items-center sticky-top"
          >
            <ul
              class="nav nav-pills nav-flush flex-sm-column flex-row flex-nowrap mb-auto mx-auto text-center justify-content-between w-100 px-3 align-items-center turkcellblue"
            >
              <li class="nav-item">
                <a
                  href="../../api/src/loaders/starter.html"
                  class="nav-link py-3 px-2 text-white"
                  title=""
                  data-bs-toggle="tooltip"
                  data-bs-placement="right"
                  data-bs-original-title="Home"
                >
                  <i class="bi bi-arrow-left fs-5"></i>
                </a>
              </li>
              <li>
                <a
                  href="#"
                  class="nav-link py-3 px-2 text-white"
                  title=""
                  data-bs-toggle="tooltip"
                  data-bs-placement="right"
                  data-bs-original-title="Dashboard"
                >
                  <i class="bi bi-list fs-5"></i>
                </a>
              </li>
            </ul>

            <div class="dropdown">
              <a
                href="#"
                class="d-flex align-items-center justify-content-center p-3 link-dark text-decoration-none dropdown-toggle turkcellblue"
                id="dropdownUser3"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="bi-person-circle fs-5 text-white"></i>
              </a>
              <ul
                class="dropdown-menu text-small shadow"
                aria-labelledby="dropdownUser3"
              >
                <li><a class="dropdown-item" href="#">New project...</a></li>
                <li><a class="dropdown-item" href="#">Settings</a></li>
                <li><a class="dropdown-item" href="#">Profile</a></li>
              </ul>
            </div>

            <a
              href="/"
              class="d-block p-3 link-dark text-decoration-none"
              style="position: fixed; bottom: 0"
              title=""
              data-bs-toggle="tooltip"
              data-bs-placement="right"
              data-bs-original-title="Icon-only"
            >
              <img
                src="AMBLEM_SARI.png"
                alt="Avatar"
                class="fs-5"
                style="width: 100%; height: 100%"
              />
            </a>
          </div>
        </div>

        <div class="col-sm p-3 min-vh-100" id="canvas">
          <div class="gallery">
            <div class="gallery-container">
              <a href="" class="directLink"
                ><div class="gallery-item gallery-item-1">
                  <img
                    id="sld"
                    src="http://fakeimg.pl/300/?text=1"
                    data-index="1"
                  /></div
              ></a>
              <a href="" class="directLink"
                ><div class="gallery-item gallery-item-2">
                  <img
                    id="sld"
                    src="http://fakeimg.pl/300/?text=2"
                    data-index="2"
                  /></div
              ></a>
              <a href="" class="directLink"
                ><div class="gallery-item gallery-item-3">
                  <img
                    id="sld"
                    src="http://fakeimg.pl/300/?text=3"
                    data-index="3"
                  /></div
              ></a>
              <a href="" class="directLink"
                ><div class="gallery-item gallery-item-4">
                  <img
                    id="sld"
                    src="http://fakeimg.pl/300/?text=4"
                    data-index="4"
                  /></div
              ></a>
              <a href="" class="directLink"
                ><div class="gallery-item gallery-item-5">
                  <img
                    id="sld"
                    src="http://fakeimg.pl/300/?text=5"
                    data-index="5"
                  /></div
              ></a>
            </div>
            <div class="gallery-controls"></div>
          </div>
        </div>

        <!-- <div class="col-sm-auto bg-light sticky-top theme-grey" style="padding:0"> -->

        <div
          class="col-md-auto flex-shrink-0 p-3 theme-grey"
          style="width: 280px"
        >
          <a
            href="/"
            class="d-flex align-items-center pb-3 mb-3 link-dark text-decoration-none border-bottom text-center"
          >
            <span class="fs-5 fw-semibold text-white px-2">
              Carousel Template</span
            >
          </a>
          <div class="componentmenutext">
            <div class="row">
              <p
                style="color: white; font-size: 1.1em"
                class="text-center mb-1.5"
              >
                Dimension
              </p>
              <div class="input-group mb-3">
                <input
                  type="text"
                  class="form-control componentmenutext"
                  placeholder="000"
                  aria-label="Username"
                />
                <span class="input-group-text componentmenutext">px</span>
                <input
                  type="text"
                  class="form-control componentmenutext"
                  placeholder="000"
                  aria-label="Server"
                />
                <span class="input-group-text componentmenutext">px</span>
              </div>
            </div>

            <div class="row">
              <p
                style="color: white; font-size: 1.1em"
                class="text-center mt-1 mb-1.5"
              >
                Width & Height
              </p>
              <div class="input-group mb-3">
                <input
                  type="number"
                  class="form-control componentmenutext dImgWidth"
                  placeholder="000"
                  aria-label="Username"
                  min="100"
                  max="400"
                />
                <span class="input-group-text componentmenutext">px</span>
                <input
                  type="number"
                  class="form-control componentmenutext dImgHeight"
                  placeholder="000"
                  aria-label="Server"
                  min="100"
                  max="400"
                />
                <span class="input-group-text componentmenutext">px</span>
              </div>
            </div>

            <input id="draggableImage" type="file" class="mt-1 text-white" />

            <p
              style="color: white; font-size: 1.1em"
              class="text-left mt-3 text-center"
            >
              Upload Background & Update Links
            </p>

            <input id="background" type="file" class="text-white" />
            <input type="text" placeholder="Link" id="link" class="mt-1" />
            <input id="background" type="file" class="mt-2 text-white" />
            <input type="text" placeholder="Link" id="link" class="mt-1" />
            <input id="background" type="file" class="mt-2 text-white" />
            <input type="text" placeholder="Link" id="link" class="mt-1" />
            <input id="background" type="file" class="mt-2 text-white" />
            <input type="text" placeholder="Link" id="link" class="mt-1" />
            <input id="background" type="file" class="mt-2 text-white" />
            <input type="text" placeholder="Link" id="link" class="mt-1" />
            <br />

            <div class="text-center">
              <button
                id="aLinks"
                class="mt-3 btn btn-outline-light btn-sm componentmenutext"
              >
                Update Links
              </button>
            </div>
            <!-- <button onclick="downloadCanvas()" class="mt-1">Download</button> -->
            <!-- <button id="test" onclick="renderDiv()" class="mt-1"> Add Div </button> -->

            <div class="text-center">
              <p
                style="color: white; font-size: 1.2em"
                class="mt-3 text-center"
              >
                Download HTML5 Creative Files
              </p>

              <button
                id="downloadHTML"
                class="btn btn-outline-light btn-sm componentmenutext text-white"
              >
                <i class="fab fa-html5" style="font-size: xx-large"></i>
              </button>
              <button
                onclick="window.open('carousel.css')"
                id="downloadCSS"
                class="btn btn-outline-light btn-sm componentmenutext"
              >
                <i class="fab fa-css3" style="font-size: xx-large"></i>
              </button>
              <button
                id="downloadJS"
                class="btn btn-outline-light btn-sm componentmenutext"
              >
                <i class="fab fa-js-square" style="font-size: xx-large"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      function download(filename, text) {
        var element = document.createElement("a");
        element.setAttribute(
          "href",
          "data:text/plain;charset=utf-8," + encodeURIComponent(text)
        );
        element.setAttribute("download", filename);

        element.style.display = "none";
        document.body.appendChild(element);

        element.click();

        document.body.removeChild(element);
      }
      var downloadHTML = document.querySelectorAll("#downloadHTML")[0];
      downloadHTML.addEventListener("click", function () {
        var canvasDiv = document.querySelectorAll("#canvas");
        var canvasContent = canvasDiv[canvasDiv.length - 1].innerHTML;
        download("canvas.html", canvasContent);
      });

      var downloadJS = document.querySelectorAll("#downloadJS")[0];
      downloadJS.addEventListener("click", function () {
        var scriptDiv = document.querySelectorAll("script");
        var scriptContent = scriptDiv[scriptDiv.length - 1].innerHTML;
        download("script.js", scriptContent);
      });

      function isValidHttpUrl(string) {
        let url;

        try {
          url = new URL(string);
        } catch (_) {
          return false;
        }

        return url.protocol === "http:" || url.protocol === "https:";
      }

      var boxes = document.querySelectorAll("#sld");

      let imgs = document.querySelectorAll("#background");
      for (var i = 0; i < imgs.length; i++) {
        (function (i) {
          imgs[i].addEventListener("change", function (event) {
            var reader = new FileReader();
            reader.onload = function (e) {
              boxes[i].src = e.target.result;
            };
            reader.readAsDataURL(imgs[i].files[0]);
          });
        })(i);
      }
      var button = document.querySelector("#aLinks");
      var aS = document.querySelectorAll(".directLink");
      button.addEventListener("click", function () {
        var linkInputs = document.querySelectorAll("#link");
        for (var i = 0; i < linkInputs.length; i++) {
          var result = isValidHttpUrl(linkInputs[i].value);
          if (result != false) {
            aS[i].href = linkInputs[i].value;
          } else {
            aS[i].href = "#";
          }
        }
      });
      const canvas = document.getElementById("canvas");
      var divHeaders = document.querySelectorAll("#mydivheader");
      for (var i = 0; i < divHeaders.length; i++) {
        (function (i) {
          divHeaders[i].addEventListener("mouseover", function (event) {
            event.target.style.opacity = 100;
            console.log(event.target);
          });
        })(i);
      }

      function renderImg(url) {
        var width = document.querySelectorAll(".dImgWidth")[0].value;
        var height = document.querySelectorAll(".dImgWidth")[0].value;
        if (width < 100 && width > 500) {
          width = 300;
        }
        if (height < 100 && height > 500) {
          height = 300;
        }
        var newElement =
          '<div id="mydiv" style="width:' +
          width +
          "px;height:" +
          height +
          '" class="mydiv p"><div id="mydivheader" class="mydivheader">Click here to move</div><img src="$link" alt="" style="width:'.replace(
            "$link",
            url
          ) +
          width +
          "px;height:" +
          height +
          'px" id="tetimg"></div>';

        canvas.innerHTML += newElement;
        elements = document.getElementsByClassName("mydivheader");
        dragElement(elements);
      }
      function renderDiv() {
        canvas.innerHTML +=
          '<div id="mydiv" class="mydiv p"><div id="mydivheader" class="mydivheader">Click here to move</div><a href="https://www.w3schools.com/howto/howto_js_draggable.asp">GOOGLE</a><p>Move</p><p>this</p><p>DIV</p></div>';
        elements = document.getElementsByClassName("mydivheader");
        dragElement(elements);
      }

      let imgUploader = document.querySelectorAll("#draggableImage")[0];
      imgUploader.addEventListener("change", function (event) {
        var reader = new FileReader();
        reader.onload = function (e) {
          let img = document.querySelectorAll("#tetimg")[0];
          renderImg(e.target.result);
        };
        reader.readAsDataURL(imgUploader.files[0]);
      });

      var loadFile = function (event) {
        var output = document.getElementById("output");
        output.src = URL.createObjectURL(event.target.files[0]);
        output.onload = function () {
          URL.revokeObjectURL(output.src); // free memory
        };
      };

      // Make the DIV element draggable:
      var rect = document.getElementById("canvas").getBoundingClientRect();
      var canvasCorners = [rect.top, rect.right, rect.bottom, rect.left];
      elements = document.getElementsByClassName("mydivheader");
      dragElement(elements);
      var currentHeader;
      function dragElement(oneElmn) {
        var pos1 = 0,
          pos2 = 0,
          pos3 = 0,
          pos4 = 0;
        for (var i = 0; i < oneElmn.length; i++) {
          oneElmn[i].onmousedown = dragMouseDown;
        }

        function dragMouseDown(e) {
          var event = e || window.event;
          var target = event.target || event.srcElement;
          currentHeader = target;
          e = e || window.event;
          e.preventDefault();
          // get the mouse cursor position at startup:
          pos3 = e.clientX;
          pos4 = e.clientY;
          document.onmouseup = closeDragElement;
          // call a function whenever the cursor moves:
          document.onmousemove = elementDrag;
        }

        function elementDrag(e) {
          elmnt = currentHeader.parentElement;
          e = e || window.event;
          e.preventDefault();
          // calculate the new cursor position:
          var width = Math.floor(elmnt.getBoundingClientRect().width) + 1;
          var height = Math.floor(elmnt.getBoundingClientRect().height) + 1;
          pos1 = pos3 - e.clientX;
          pos2 = pos4 - e.clientY;
          pos3 = e.clientX;
          pos4 = e.clientY;
          // set the element's new position:
          if (
            elmnt.offsetLeft - pos1 + width < canvasCorners[1] &&
            elmnt.offsetLeft - pos1 > canvasCorners[3]
          ) {
            elmnt.style.left = elmnt.offsetLeft - pos1 + "px";
          }
          if (
            elmnt.offsetTop - pos2 + height < canvasCorners[2] &&
            elmnt.offsetTop - pos2 > canvasCorners[0]
          ) {
            elmnt.style.top = elmnt.offsetTop - pos2 + "px";
          }
        }

        function closeDragElement() {
          for (var i = 0; i < divHeaders.length; i++) {
            divHeaders[i].style.opacity = 0;
          }
          // stop moving when mouse button is released:
          document.onmouseup = null;
          document.onmousemove = null;
        }
      }
      const galleryContainer = document.querySelector(".gallery-container");
      const galleryControlsContainer =
        document.querySelector(".gallery-controls");
      const galleryControls = ["previous", "next"];
      const galleryItems = document.querySelectorAll(".gallery-item");

      class Carousel {
        constructor(container, items, controls) {
          this.carouselContainer = container;
          this.carouselControls = controls;
          this.carouselArray = [...items];
        }

        // Update css classes for gallery
        updateGallery() {
          this.carouselArray.forEach((el) => {
            el.classList.remove("gallery-item-1");
            el.classList.remove("gallery-item-2");
            el.classList.remove("gallery-item-3");
            el.classList.remove("gallery-item-4");
            el.classList.remove("gallery-item-5");
          });

          this.carouselArray.slice(0, 5).forEach((el, i) => {
            el.classList.add(`gallery-item-${i + 1}`);
          });
        }

        // Update the current order of the carouselArray and gallery
        setCurrentState(direction) {
          if (direction.className == "gallery-controls-previous") {
            this.carouselArray.unshift(this.carouselArray.pop());
          } else {
            this.carouselArray.push(this.carouselArray.shift());
          }

          this.updateGallery();
        }

        // Construct the carousel navigation
        // setNav() {
        // galleryContainer.appendChild(document.createElement('ul')).className = 'gallery-nav';

        // this.carouselArray.forEach(item => {
        //   const nav = galleryContainer.lastElementChild;
        //   nav.appendChild(document.createElement('li'));
        // });
        // }s

        // Construct the carousel controls
        setControls() {
          this.carouselControls.forEach((control) => {
            galleryControlsContainer.appendChild(
              document.createElement("button")
            ).className = `gallery-controls-${control}`;

            document.querySelector(`.gallery-controls-${control}`).innerText =
              control;
          });
        }

        // Add a click event listener to trigger setCurrentState method to rearrange carousel
        useControls() {
          const triggers = [...galleryControlsContainer.childNodes];

          triggers.forEach((control) => {
            control.addEventListener("click", (e) => {
              e.preventDefault();

              if (control.className == "gallery-controls-add") {
                const newItem = document.createElement("img");
                const latestItem = this.carouselArray.length;
                const latestIndex =
                  this.carouselArray.findIndex(
                    (item) =>
                      item.getAttribute("data-index") ==
                      this.carouselArray.length
                  ) + 1;

                // Assign the necessary properties for new gallery item
                Object.assign(newItem, {
                  className: "gallery-item",
                  src: `http://fakeimg.pl/300/?text=${
                    this.carouselArray.length + 1
                  }`,
                });
                newItem.setAttribute(
                  "data-index",
                  this.carouselArray.length + 1
                );

                // Then add it to the carouselArray and update the gallery
                this.carouselArray.splice(latestIndex, 0, newItem);
                document
                  .querySelector(`[data-index="${latestItem}"]`)
                  .after(newItem);
                this.updateGallery();
              } else {
                this.setCurrentState(control);
              }
            });
          });
        }
      }

      const exampleCarousel = new Carousel(
        galleryContainer,
        galleryItems,
        galleryControls
      );

      exampleCarousel.setControls();
      // exampleCarousel.setNav();
      exampleCarousel.useControls();
    </script>
  </body>
</html>
